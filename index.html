<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OtOjs Â· è§£å¯†å‰ç«¯ï¼ˆè‡ªåŠ¨è½®è¯¢ï¼Œæ— å€’è®¡æ—¶ï¼‰</title>
<style>
  :root{
    --bg:#0b0f14;--card:#0f1621;--muted:#9db1c7;--line:#1f2937;--line2:#223046;
    --text:#e6eef7;--btn:#152033;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;--link:#67e8f9;
    --accent:#3b82f6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
  a{color:var(--link)}
  .wrap{max-width:960px;margin:0 auto;padding:18px 14px 80px}
  h1{margin:10px 0 6px;font-size:20px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0}
  label{font-size:12px;color:var(--muted);margin-right:6px}
  input,select,textarea{width:100%;background:#0f1a2b;color:var(--text);border:1px solid var(--line2);border-radius:10px;padding:10px;font-size:13px}
  textarea{min-height:160px;font-family:ui-monospace,Consolas,Menlo,monospace}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
  .row>*{flex:1 1 200px}
  button{padding:10px 12px;border-radius:10px;border:1px solid #2b3b54;background:var(--btn);color:var(--text);cursor:pointer;font-weight:600}
  button.ok{border-color:var(--ok)}
  button.warn{border-color:var(--warn)}
  button.err{border-color:var(--err)}
  pre{white-space:pre-wrap;background:#0b1020;border:1px solid var(--line2);border-radius:10px;padding:10px;font-size:12px;max-height:380px;overflow:auto}
  small{color:var(--muted)}
  .bar-wrap{height:6px;background:#0b1020;border:1px solid var(--line2);border-radius:8px;overflow:hidden;margin-top:6px}
  .bar{height:100%;width:0%;background:var(--accent);transition:width 5s linear}
  .pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line2);border-radius:999px;padding:6px 10px;background:#0b1020}
  .hint{font-size:12px;color:var(--muted)}

  /* â€”â€” ç´§å‡‘ä¸€æ’äº”ä¸ªæŒ‰é’®ï¼ˆèŠ‚çœç©ºé—´ï¼‰ â€”â€” */
  .btnbar{
    display:grid; grid-template-columns:repeat(5,1fr);
    gap:6px; margin-top:8px; position:relative; z-index:1;
  }
  .btncard{
    min-width:0; max-width:none;
    padding:10px 6px; border-radius:10px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.18);
    color:#fff; display:flex;
    flex-direction:column; align-items:center; justify-content:center;
    cursor:pointer; transition:transform .15s,background .15s,box-shadow .15s;
  }
  .btncard:hover{background:rgba(255,255,255,.12); transform:translateY(-1px); box-shadow:0 3px 8px rgba(0,0,0,.2)}
  .btnicon{font-size:16px}
  .btntxt{font-size:11px; font-weight:600; margin-top:2px}

  /* â€”â€” è¿œç¨‹å¼¹çª—ï¼ˆæ‚¬æµ®ï¼Œä¸å å¸ƒå±€ï¼‰ â€”â€” */
  .remote-pop{
    position:fixed; left:0; top:0; width:min(92vw,360px);
    background:#0f1621; border:1px solid var(--line2); border-radius:12px;
    padding:10px; box-shadow:0 12px 28px rgba(0,0,0,.35);
    display:none; z-index:9999;
  }
  .remote-pop.show{display:block;}
  .remote-pop .pop-row{display:flex; gap:8px; margin-top:6px}
  .remote-pop input[type="url"]{
    flex:1 1 auto; min-width:0; background:#0f1a2b; border:1px solid var(--line2);
    border-radius:10px; padding:10px; color:var(--text); font-size:13px;
  }
  .remote-pop .pop-btn{
    white-space:nowrap; padding:8px 12px; border-radius:10px; border:1px solid #2b3b54;
    background:var(--btn); color:var(--text); cursor:pointer;
  }
  .remote-pop .pop-btn.ok{ border-color:var(--ok) }
  .remote-pop .pop-btn.cancel{ border-color:var(--err) }
</style>
</head>
<body>
<div class="wrap">
  <h1>OtOjs Â· è§£å¯†å‰ç«¯ï¼ˆè‡ªåŠ¨è½®è¯¢ï¼Œæ— å€’è®¡æ—¶ï¼‰</h1>

  <div class="card">
    <div class="row">
      <div style="flex:2">
        <label>REPO</label>
        <input id="repo" value="Mikephie/OtOjs" />
      </div>
      <div>
        <label>BRANCH</label>
        <input id="branch" value="main" />
      </div>
      <div>
        <label>Tokenï¼ˆcontents:rwï¼‰</label>
        <input id="token" type="password" placeholder="ghp_..." />
      </div>
    </div>
    <div class="row">
      <div>
        <label>input.js è·¯å¾„</label>
        <input id="pathIn" value="input.js" />
      </div>
      <div>
        <label>é»˜è®¤è¾“å‡ºè·¯å¾„</label>
        <input id="pathOut" value="output/output.js" />
      </div>
      <div>
        <label>æäº¤ä¿¡æ¯</label>
        <input id="commitMsg" value="update: input.js via UI" />
      </div>
    </div>
    <div class="row">
      <div>
        <label>è¦æ‹‰å–å“ªä¸ªè¾“å‡ºæ–‡ä»¶ï¼Ÿ</label>
        <select id="whichOut">
          <option value="output/output.js">ç¬¬â‘ æ¬¡äº§ç‰©ï¼šoutput/output.js</option>
          <option value="output/output.deob2.js">ç¬¬â‘¡æ¬¡äº§ç‰©ï¼šoutput/output.deob2.js</option>
        </select>
      </div>
      <div>
        <label>è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰</label>
        <input id="pollSec" type="number" value="5" />
      </div>
      <div>
        <label>æœ€å¤§ç­‰å¾…ï¼ˆç§’ï¼‰</label>
        <input id="maxWait" type="number" value="150" />
      </div>
    </div>
    <div class="hint">æäº¤åè‡ªåŠ¨è½®è¯¢ä½ é€‰æ‹©çš„è¾“å‡ºæ–‡ä»¶ï¼›ä¹Ÿå¯éšæ—¶åˆ‡æ¢å¹¶æ‰‹åŠ¨æ‹‰å–ã€‚</div>
  </div>

  <div class="card">
    <small>æŠŠå¾…è§£å¯†è„šæœ¬æ”¾åˆ° <b>input.js</b> â†’ å·¥ä½œæµè‡ªåŠ¨è·‘ â†’ åœ¨ä½ é€‰æ‹©çš„è¾“å‡ºæ–‡ä»¶ä¸­è·å–ç»“æœ</small>

    <!-- éšè—æ–‡ä»¶ inputï¼ˆç”±â€œæ–‡ä»¶â€å¡ç‰‡è§¦å‘ï¼‰ -->
    <input type="file" id="file" accept=".js,.txt,.json" hidden />

    <!-- æŒ‰é’®æ ï¼šä¸€æ’ç´§å‡‘å°æŒ‰é’® -->
    <div class="btnbar" id="quick-btns">
      <label for="file" class="btncard" id="btn-file" role="button" tabindex="0" aria-label="æ–‡ä»¶">
        <span class="btnicon">ğŸ“</span><span class="btntxt">æ–‡ä»¶</span>
      </label>
      <div class="btncard" id="btn-remote" role="button" tabindex="0" aria-expanded="false" aria-controls="remote-pop">
        <span class="btnicon">ğŸŒ</span><span class="btntxt">è¿œç¨‹</span>
      </div>
      <button class="btncard" id="btn-paste" type="button" aria-label="ç²˜è´´">
        <span class="btnicon">ğŸ“‹</span><span class="btntxt">ç²˜è´´</span>
      </button>
      <button class="btncard" id="btn-clean" type="button" aria-label="æ ¼å¼">
        <span class="btnicon">ğŸ§¹</span><span class="btntxt">æ ¼å¼</span>
      </button>
      <button class="btncard" id="btn-clear" type="button" aria-label="æ¸…ç©º">
        <span class="btnicon">ğŸ—‘ï¸</span><span class="btntxt">æ¸…ç©º</span>
      </button>
    </div>

    <!-- è¿œç¨‹å¼¹çª—ï¼ˆæ‚¬æµ®å±‚ï¼‰ -->
    <div class="remote-pop" id="remote-pop" role="dialog" aria-label="è¿œç¨‹åŠ è½½">
      <input id="remoteUrlInline" type="url" placeholder="https:// åŸå§‹è„šæœ¬ URLï¼ˆæ”¯æŒ github/blob â†’ rawï¼‰" />
      <div class="pop-row">
        <button class="pop-btn ok" id="remote-confirm">æ‹‰å–</button>
        <button class="pop-btn cancel" id="remote-cancel">å–æ¶ˆ</button>
      </div>
    </div>
    <!-- éšè— URL è¾“å…¥ï¼šä¸ loadRemote() å¯¹æ¥ -->
    <input id="remoteUrl" type="url" style="display:none" />

    <textarea id="codeIn" placeholder="æŠŠå¾…è§£å¯†çš„ JS ç²˜è´´åˆ°è¿™é‡Œï¼Œæˆ–ç”¨ä¸Šæ–¹å¯¼å…¥"></textarea>
    <div class="row">
      <button class="ok" onclick="submitInput()">â‘  æäº¤åˆ° input.js (PUT)</button>
      <button class="warn" onclick="startAutoPoll()">â‘¡ å¼€å§‹è‡ªåŠ¨è½®è¯¢ï¼ˆæ ¹æ®é€‰æ‹©çš„è¾“å‡ºæ–‡ä»¶ï¼‰</button>
      <button onclick="beautify()">ï¼ˆå¯é€‰ï¼‰ç»“æœç¾åŒ–</button>
      <button onclick="copySel('#codeOut', this)">å¤åˆ¶ç»“æœ</button>
      <button class="err" onclick="clrAll()">æ¸…ç©ºè¾“å…¥ä¸ç»“æœ</button>
    </div>
    <div id="status"><small>çŠ¶æ€ï¼šå°±ç»ª</small></div>
    <div class="bar-wrap" id="barWrap" style="display:none"><div class="bar" id="bar"></div></div>
    <pre id="codeOut" placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"></pre>
  </div>

  <div class="card">
    <div class="row">
      <div class="pill">
        <span>å¿«é€Ÿæ‹‰å– Rawï¼š</span>
        <button onclick="loadOutputRaw('output/output.js')">output/output.js</button>
        <button onclick="loadOutputRaw('output/output.deob2.js')">output/output.deob2.js</button>
      </div>
      <button onclick="copySel('#outputRaw', this)">å¤åˆ¶</button>
      <button onclick="downloadOutput()">ä¸‹è½½å½“å‰ç»“æœ</button>
    </div>
    <pre id="outputRaw"></pre>
  </div>
</div>

<script>
/* ====== ä½ çš„åŸæœ‰åŠŸèƒ½å‡½æ•°ï¼ˆå®Œæ•´ä¿ç•™ï¼‰ ====== */
const $=s=>document.querySelector(s);
function setStatus(msg){ $('#status').innerHTML = '<small>çŠ¶æ€ï¼š'+ msg +'</small>'; }
function showBar(){ $('#barWrap').style.display='block'; const b=$('#bar'); b.style.transition='none'; b.style.width='0%'; void b.offsetWidth; b.style.transition='width 5s linear'; b.style.background='var(--accent)'; setTimeout(()=>b.style.width='100%',50); }
function okBar(){ $('#bar').style.background='var(--ok)'; }
function warnBar(){ $('#bar').style.background='var(--warn)'; }
function hideBar(){ $('#barWrap').style.display='none'; }

function ghHeaders(){
  const t=$('#token').value.trim();
  if(!t){ throw new Error('ç¼ºå°‘ Tokenï¼ˆéœ€è¦ contents: read & writeï¼‰'); }
  return {
    'Authorization':'Bearer '+t,
    'Accept':'application/vnd.github+json',
    'If-None-Match': '' // ç¦æ­¢æ²¿ç”¨æ—§ ETag
  };
}
function repoBase(){ return `https://api.github.com/repos/${$('#repo').value.trim()}` }
function nowTs(){ return Date.now().toString() }

// æœ¬åœ°æ–‡ä»¶
function pick(){ $('#file').click(); }
$('#file').addEventListener('change', async (e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  const txt=await f.text(); $('#codeIn').value=txt; setStatus('å·²è½½å…¥æœ¬åœ°æ–‡ä»¶ï¼š'+f.name+' Â· '+txt.length+' å­—ç¬¦');
});

// è¿œç¨‹åŠ è½½ï¼ˆæ”¯æŒ github/blob â†’ rawï¼‰
async function loadRemote(){
  let u=$('#remoteUrl').value.trim(); if(!u){ setStatus('è¯·è¾“å…¥ URL'); return }
  if(/https?:\/\/github\.com\/.+\/blob\//.test(u)){
    u=u.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/');
  }
  try{
    const r=await fetch(u+'?t='+nowTs(),{cache:'no-store'}); const t=await r.text();
    if(!r.ok) throw new Error(r.status+' '+r.statusText+' '+t.slice(0,200));
    $('#codeIn').value=t; setStatus('è¿œç¨‹å·²åŠ è½½ Â· '+t.length+' å­—ç¬¦');
  }catch(e){ setStatus('è¿œç¨‹åŠ è½½å¤±è´¥ï¼š'+e.message); }
}

// ç²˜è´´æ¿
async function pasteFromClipboard(){
  try{ const t=await navigator.clipboard.readText(); $('#codeIn').value=t; setStatus('å·²ä»å‰ªè´´æ¿ç²˜è´´ Â· '+t.length+' å­—ç¬¦'); }
  catch(e){ setStatus('ç²˜è´´å¤±è´¥ï¼š'+e.message); }
}

// æ¸…ç©º
function clrIn(){ $('#codeIn').value=''; setStatus('å·²æ¸…ç©ºè¾“å…¥'); }
function clrAll(){ $('#codeIn').value=''; $('#codeOut').textContent=''; $('#outputRaw').textContent=''; hideBar(); setStatus('å·²æ¸…ç©ºè¾“å…¥ä¸ç»“æœ'); }

// Base64 â†’ UTF8
function b64ToUtf8(b64){ try{ return decodeURIComponent(escape(atob(b64))) }catch{ return atob(b64) } }

// æäº¤ input.jsï¼ˆPUTï¼‰
async function submitInput(){
  const path=$('#pathIn').value.trim()||'input.js';
  const api=`${repoBase()}/contents/${path}`;
  const code=$('#codeIn').value;
  if(!code){ setStatus('æ²¡æœ‰å¯ä¸Šä¼ çš„å†…å®¹'); return }
  try{
    let sha='';
    const head=await fetch(`${api}?ref=${$('#branch').value.trim()}&t=${nowTs()}`,{headers:ghHeaders(),cache:'no-store'});
    if(head.ok){ const j=await head.json(); sha=j.sha||''; }
    const body={
      message: $('#commitMsg').value.trim()||'update via UI',
      content: btoa(unescape(encodeURIComponent(code))),
      branch: $('#branch').value.trim(),
      sha: sha||undefined
    };
    const res=await fetch(api,{ method:'PUT', headers:{ 'Content-Type':'application/json', ...ghHeaders() }, cache:'no-store', body: JSON.stringify(body) });
    const txt=await res.text();
    if(!res.ok) throw new Error(res.status+' '+res.statusText+' â†’ '+txt.slice(0,200));
    setStatus('æäº¤æˆåŠŸ Â· å·¥ä½œæµå°†è‡ªåŠ¨å¼€å§‹');
    startAutoPoll(true);
  }catch(e){ setStatus('æäº¤å¤±è´¥ï¼š'+e.message); }
}

// â€”â€” è‡ªåŠ¨è½®è¯¢ â€”â€”ï¼ˆæ— å€’è®¡æ—¶ï¼Œä»…åŠ¨ç”»æ¡ + é—´éš”è½®è¯¢ + æœ€å¤§ç­‰å¾…ï¼‰
let pollingTimer=null, barTimer=null;
async function startAutoPoll(){
  try{ ghHeaders(); }catch(e){ setStatus(e.message); return }
  if(pollingTimer){ clearInterval(pollingTimer); pollingTimer=null; }
  if(barTimer){ clearInterval(barTimer); barTimer=null; }

  const which=$('#whichOut').value;
  const branch=$('#branch').value.trim();
  const api=`${repoBase()}/contents/${which}?ref=${branch}`;
  const interval=Math.max(2, parseInt($('#pollSec').value||'5',10))*1000;
  const maxWait=Math.max(10, parseInt($('#maxWait').value||'150',10))*1000;

  let lastSha=''; // é˜²æ­¢æŠŠæ—§å†…å®¹å½“æ–°å†…å®¹
  let waited=0;

  setStatus('æ­£åœ¨è½®è¯¢ï¼š'+which);
  showBar();
  barTimer=setInterval(()=>{ const b=$('#bar'); b.style.transition='none'; b.style.width='0%'; void b.offsetWidth; b.style.transition='width 5s linear'; b.style.width='100%'; },5000);

  // å…ˆæ‹‰ä¸€æ¬¡
  await tryFetch();

  pollingTimer=setInterval(async ()=>{
    waited+=interval;
    const done=await tryFetch();
    if(done){ clearInterval(pollingTimer); pollingTimer=null; clearInterval(barTimer); barTimer=null; okBar(); return; }
    if(waited>=maxWait){
      clearInterval(pollingTimer); pollingTimer=null;
      clearInterval(barTimer); barTimer=null;
      warnBar();
      setStatus('âŒ› è¶…æ—¶ï¼šä»æœªè·å–åˆ° '+which+'ï¼Œå¯èƒ½ Actions è¿˜åœ¨è·‘æˆ–å¤±è´¥');
    }
  }, interval);

  async function tryFetch(){
    try{
      const r=await fetch(api+'&t='+nowTs(),{headers:ghHeaders(),cache:'no-store'});
      const raw=await r.text();
      if(!r.ok){
        setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆHTTP '+r.status+'ï¼‰');
        return false;
      }
      const j=JSON.parse(raw);
      const sha=j.sha||'';
      if(sha && sha===lastSha){
        setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆæœªæ›´æ–°ï¼‰');
        return false;
      }
      const b64=(j.content||'').replace(/\n/g,'');
      const out=j.content?b64ToUtf8(b64):'';
      if(out && out.trim()){
        lastSha=sha||nowTs();
        $('#codeOut').textContent=out;
        setStatus('âœ… å·²è·å–åˆ°æœ€æ–° '+which+' Â· '+(out.length)+' å­—ç¬¦');
        return true;
      }else{
        setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆæ–‡ä»¶ä¸ºç©ºæˆ–æœªç”Ÿæˆï¼‰');
        return false;
      }
    }catch(e){
      setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆ'+e.message+'ï¼‰');
      return false;
    }
  }
}

// æ‰‹åŠ¨æ‹‰å– Rawï¼ˆä¸¤æŒ‰é’®åˆ†åˆ«æ‹‰ä¸¤ä¸ªè·¯å¾„ï¼‰
async function loadOutputRaw(path){
  path = path || $('#whichOut').value;
  const url=`https://raw.githubusercontent.com/${$('#repo').value.trim()}/${$('#branch').value.trim()}/${path}?t=${nowTs()}`;
  try{
    const r=await fetch(url,{cache:'no-store'}); const t=await r.text();
    if(!r.ok) throw new Error(r.status+' '+r.statusText);
    $('#outputRaw').textContent=t;
    setStatus('å·²æ‹‰å– Raw Â· '+path+' Â· '+t.length+' å­—ç¬¦');
  }catch(e){
    $('#outputRaw').textContent='æ‹‰å–å¤±è´¥ï¼š'+e.message+'\n'+url;
    setStatus('æ‹‰å–å¤±è´¥');
  }
}

// ä¸‹è½½ï¼ˆä¼˜å…ˆ codeOutï¼Œå…¶æ¬¡ Rawï¼‰
function downloadOutput(){
  const t=$('#codeOut').textContent||$('#outputRaw').textContent||'';
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([t],{type:'text/javascript;charset=utf-8'}));
  const which=$('#whichOut').value.split('/').pop()||'output.js';
  a.download=which;
  a.click(); URL.revokeObjectURL(a.href);
}

// Prettierï¼ˆå¯é€‰ï¼‰
async function ensurePrettier(){
  if(window.prettier&&window.prettierPlugins&&window.prettierPlugins.babel) return;
  const s1=document.createElement('script'); s1.src='https://unpkg.com/prettier@3.2.5/standalone.js';
  const s2=document.createElement('script'); s2.src='https://unpkg.com/prettier@3.2.5/plugins/babel.js';
  document.body.appendChild(s1); await new Promise(r=>s1.onload=r);
  document.body.appendChild(s2); await new Promise(r=>s2.onload=r);
}
async function beautify(){
  let s=$('#codeOut').textContent||$('#codeIn').value||'';
  if(!s){ setStatus('æ— å¾…ç¾åŒ–å†…å®¹'); return }
  try{
    await ensurePrettier();
    const out=prettier.format(s,{parser:'babel',plugins:[prettierPlugins.babel]});
    $('#codeOut').textContent=out;
    setStatus('å·²ç”¨ Prettier ç¾åŒ–');
  }catch(e){ setStatus('Prettier å¤±è´¥ï¼š'+e.message); }
}

// å¤åˆ¶
async function copySel(sel,btn){
  try{
    const el=$(sel); const t=el?(el.value??el.textContent??''):'';
    await navigator.clipboard.writeText(t);
    const old=btn.textContent; btn.textContent='âœ… å·²å¤åˆ¶'; setTimeout(()=>btn.textContent=old,1200);
  }catch(e){ setStatus('å¤åˆ¶å¤±è´¥ï¼š'+e.message); }
}

/* ====== è¿œç¨‹å¼¹çª—äº¤äº’ï¼ˆä¸æ”¹ loadRemoteï¼šåªæŠŠå€¼å†™å…¥ #remoteUrl å†è°ƒç”¨å®ƒï¼‰ ====== */
(function(){
  const btn = document.getElementById('btn-remote');
  const pop = document.getElementById('remote-pop');
  const inputInline = document.getElementById('remoteUrlInline');
  const inputHidden = document.getElementById('remoteUrl');
  const confirmBtn  = document.getElementById('remote-confirm');
  const cancelBtn   = document.getElementById('remote-cancel');

  function placePop(){
    const r = btn.getBoundingClientRect();
    const popW = Math.min(360, Math.max(260, r.width*2));
    pop.style.width = popW + 'px';
    let left = r.left + r.width/2 - popW/2;
    left = Math.max(8, Math.min(left, window.innerWidth - popW - 8));
    const top = r.bottom + 8;
    pop.style.left = left + 'px';
    pop.style.top  = top + 'px';
  }
  function openPop(){
    placePop();
    pop.classList.add('show');
    btn.setAttribute('aria-expanded','true');
    setTimeout(()=>inputInline?.focus(), 0);
    window.addEventListener('resize', placePop);
    window.addEventListener('scroll', placePop, {passive:true});
  }
  function closePop(){
    pop.classList.remove('show');
    btn.setAttribute('aria-expanded','false');
    window.removeEventListener('resize', placePop);
    window.removeEventListener('scroll', placePop);
  }

  btn.addEventListener('click', (e)=>{ e.preventDefault(); pop.classList.contains('show')? closePop(): openPop(); });
  btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); } });

  cancelBtn.addEventListener('click', (e)=>{ e.preventDefault(); closePop(); });

  async function doFetchFromInline(){
    const u = (inputInline.value||'').trim();
    if(!u){ setStatus('è¯·è¾“å…¥ URL'); inputInline.focus(); return; }
    inputHidden.value = u;    // å†™å…¥éšè— input
    closePop();               // å…³é—­å¼¹çª—
    try{ await loadRemote(); }catch(err){ console.error(err); }
  }
  confirmBtn.addEventListener('click', (e)=>{ e.preventDefault(); doFetchFromInline(); });
  inputInline.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); doFetchFromInline(); } });

  document.addEventListener('click', (e)=>{
    const inBtn = btn.contains(e.target);
    const inPop = pop.contains(e.target);
    if(!inBtn && !inPop) closePop();
  });

  // å…¶ä»–æŒ‰é’®ç»‘å®šï¼ˆä¿æŒåŠŸèƒ½ä¸å˜ï¼‰
  document.getElementById('btn-paste')?.addEventListener('click', (e)=>{ e.preventDefault(); pasteFromClipboard(); });
  document.getElementById('btn-clean')?.addEventListener('click', (e)=>{ e.preventDefault(); beautify(); });
  document.getElementById('btn-clear')?.addEventListener('click', (e)=>{ e.preventDefault(); clrIn(); });
})();
</script>
</body>
</html>