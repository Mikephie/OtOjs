<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deobf Outputs Viewer</title>
  <style>
    :root { --accent: #6c9cff; --bg:#0b0f14; --panel:#111824; --text:#e8eef7; --muted:#9bb0c9; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid #1d2636;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .head{padding:18px 20px;border-bottom:1px solid #1a2231}
    .body{padding:18px 20px}
    select,button,.path{height:40px;border-radius:10px;border:1px solid #2a3850;background:#0e1521;color:var(--text);padding:0 12px}
    select:focus,button:focus,.path:focus{outline:2px solid var(--accent)}
    button{background:var(--accent);border-color:transparent;font-weight:600;cursor:pointer}
    button.secondary{background:#1b2a42}
    .muted{color:var(--muted)}
    .log{white-space:pre-wrap;background:#0a111c;border:1px solid #1a2231;border-radius:10px;padding:14px;max-height:60vh;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .hidden{display:none}

    /* åœ†ç¯è¿›åº¦æ¡ */
    .ring{position:relative;width:86px;height:86px}
    .ring svg{transform:rotate(-90deg);width:86px;height:86px}
    .ring circle.track{stroke:#1f2a3f;stroke-width:8;fill:none}
    .ring circle.progress{stroke:var(--accent);stroke-width:8;fill:none;stroke-linecap:round;stroke-dasharray:251.2; /* 2Ï€r r=40 */ stroke-dashoffset:251.2; transition:stroke-dashoffset .2s linear}
    .ring .txt{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:700}
    .status{display:flex;align-items:center;gap:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="row" style="align-items:center;justify-content:space-between">
          <h2 style="margin:0">ğŸ§© Deobf Outputs</h2>
          <span class="muted">é€‰æ‹©è¾“å‡ºæ–‡ä»¶ â†’ è·å–ï¼ˆå¸¦ 60 ç§’åŠ¨ç”»ï¼‰</span>
        </div>
      </div>
      <div class="body">
        <div class="row">
          <select id="path">
            <option value="output/output.js">output/output.js</option>
            <option value="output/output.deob2.js">output/output.deob2.js</option>
          </select>
          <input id="custom" class="path" placeholder="æˆ–è‡ªå®šä¹‰ç›¸å¯¹è·¯å¾„ï¼ˆå¯é€‰ï¼‰"/>
          <button id="fetchBtn">è·å–æ–‡ä»¶</button>
          <button class="secondary" id="cancelBtn">å–æ¶ˆ</button>
        </div>

        <div id="progressBlock" class="row hidden" style="margin-top:14px;align-items:center">
          <div class="status">
            <div class="ring">
              <svg viewBox="0 0 100 100" aria-hidden="true">
                <circle class="track" cx="50" cy="50" r="40"></circle>
                <circle class="progress" id="ringProgress" cx="50" cy="50" r="40"></circle>
              </svg>
              <div class="txt"><span id="count">60</span>s</div>
            </div>
            <div>
              <div id="stateText">æ­£åœ¨è·å–â€¦ï¼ˆæœ€å¤š 60 ç§’ï¼‰</div>
              <div class="muted" id="smallHint">è‹¥æå‰è·å–åˆ°å†…å®¹ï¼Œä¼šç«‹å³ç»“æŸåŠ¨ç”»å¹¶æ˜¾ç¤ºç»“æœ</div>
            </div>
          </div>
        </div>

        <div class="tools">
          <button class="secondary" id="copyBtn" title="å¤åˆ¶åˆ°å‰ªè´´æ¿">å¤åˆ¶</button>
          <button class="secondary" id="downloadBtn" title="ä¸‹è½½æ–‡ä»¶">ä¸‹è½½</button>
        </div>

        <div id="log" class="log" style="margin-top:10px;">ğŸ“„ ç­‰å¾…è·å–â€¦</div>
      </div>
    </div>
  </div>

  <script>
  (() => {
    const $ = sel => document.querySelector(sel);
    const pathSel = $('#path');
    const custom = $('#custom');
    const fetchBtn = $('#fetchBtn');
    const cancelBtn = $('#cancelBtn');
    const log = $('#log');
    const ring = $('#ringProgress');
    const count = $('#count');
    const progressBlock = $('#progressBlock');
    const stateText = $('#stateText');
    const copyBtn = $('#copyBtn');
    const downloadBtn = $('#downloadBtn');

    let ctrl = null;           // AbortController
    let timer = null;          // å€’è®¡æ—¶ setInterval
    let left = 60;             // ç§’
    const full = 2 * Math.PI * 40; // å‘¨é•¿ 2Ï€r

    function currentPath() {
      const c = custom.value.trim();
      return c ? c : pathSel.value;
    }

    function setProgress(secLeft) {
      count.textContent = secLeft;
      const ratio = (60 - secLeft) / 60; // 0..1
      ring.style.strokeDashoffset = String(full * (1 - ratio));
    }

    function startAnim() {
      left = 60;
      setProgress(left);
      progressBlock.classList.remove('hidden');
      stateText.textContent = 'æ­£åœ¨è·å–â€¦ï¼ˆæœ€å¤š 60 ç§’ï¼‰';
      timer = setInterval(() => {
        left = Math.max(0, left - 1);
        setProgress(left);
        if (left === 0) {
          stateText.textContent = 'ä»åœ¨è·å–ä¸­â€¦å¦‚æ— å“åº”å¯å–æ¶ˆé‡è¯•';
          // ä¸å¼ºåˆ¶ä¸­æ–­ fetchï¼›ä»…æç¤º
          clearInterval(timer);
          timer = null;
        }
      }, 1000);
    }

    function stopAnim() {
      if (timer) { clearInterval(timer); timer = null; }
      progressBlock.classList.add('hidden');
    }

    async function doFetch() {
      const p = currentPath();
      if (ctrl) { ctrl.abort(); }
      ctrl = new AbortController();

      startAnim();
      log.textContent = `ğŸ“¡ GET ${p}\n`;
      try {
        const res = await fetch(p, { signal: ctrl.signal, cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        stopAnim();
        stateText.textContent = 'å·²å®Œæˆ';
        log.textContent = text || 'ï¼ˆç©ºæ–‡ä»¶ï¼‰';
        // è¿›åº¦ç›´æ¥å¡«æ»¡
        ring.style.strokeDashoffset = '0';
        count.textContent = '0';
      } catch (err) {
        stopAnim();
        log.textContent = `âŒ è·å–å¤±è´¥ï¼š${err.message}\nè·¯å¾„ï¼š${p}\næç¤ºï¼šè¯·ç¡®è®¤è¯¥æ–‡ä»¶å·²è¢«å·¥ä½œæµäº§å‡ºå¹¶æäº¤åˆ°ä»“åº“ï¼›æˆ–è¯•è¯•å¦ä¸€ä¸ªé€‰é¡¹/è‡ªå®šä¹‰è·¯å¾„ã€‚`;
      }
    }

    fetchBtn.addEventListener('click', doFetch);
    cancelBtn.addEventListener('click', () => {
      if (ctrl) ctrl.abort();
      stopAnim();
      log.textContent = 'â¹ï¸ å·²å–æ¶ˆ';
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(log.textContent);
        copyBtn.textContent = 'å·²å¤åˆ¶ âœ“';
        setTimeout(()=>copyBtn.textContent='å¤åˆ¶', 1200);
      } catch { copyBtn.textContent = 'å¤åˆ¶å¤±è´¥'; setTimeout(()=>copyBtn.textContent='å¤åˆ¶', 1200); }
    });

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([log.textContent], { type: 'text/javascript;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      const name = currentPath().split('/').pop() || 'output.js';
      a.download = name;
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // åˆå§‹é»˜è®¤ä¸è‡ªåŠ¨æ‹‰å–ï¼›å¦‚éœ€è‡ªåŠ¨æ‹‰å–ï¼Œå¯è§£é™¤ä¸‹ä¸€è¡Œæ³¨é‡Š
    // doFetch();
  })();
  </script>
</body>
</html>