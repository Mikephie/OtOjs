<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OtOjs æ§åˆ¶å° + è§£ç å™¨ï¼ˆç¨³å®šç‰ˆï¼‰</title>
  <meta name="description" content="GitHub å¿«æ·æ“ä½œ + ç§‘æŠ€è§£ç å™¨ï¼šä»“åº“è®¾ç½®ã€Raw/API ç”Ÿæˆã€curlã€Token ç›´ä¼ ã€æ–‡ä»¶/è¿œç¨‹/ç²˜è´´ã€Prettierã€ç¾åŒ–ã€é¢„è§ˆã€ä¸‹è½½ã€‚" />
  <style>
    :root{--bg:radial-gradient(1200px 800px at 10% 0%,#0ea5e95c 0%,transparent 50%),radial-gradient(900px 700px at 90% 20%,#22c55e40 0%,transparent 60%),linear-gradient(180deg,#0b0f14 0%,#0b0f14 60%,#0b0f14 100%);--card:rgba(255,255,255,.06);--card-2:rgba(255,255,255,.08);--text:#e6eef7;--muted:#9db1c7;--accent:#6ee7ff;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;--radius:18px;--shadow:0 10px 30px rgba(0,0,0,.28),inset 0 1px 0 rgba(255,255,255,.06);--glass:blur(8px) saturate(120%)}
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:var(--accent)}
    .container{max-width:1200px;margin:0 auto;padding:20px 12px 100px}
    header{display:flex;align-items:center;gap:12px;margin:8px 0 16px}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#22d3ee,#a78bfa);box-shadow:0 8px 24px rgba(124,58,237,.35),inset 0 1px 0 rgba(255,255,255,.3)}
    h1{font-size:22px;margin:0}
    .muted{color:var(--muted);font-size:12px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .card{grid-column:span 12;background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:var(--glass)}
    .card h2{margin:0;padding:14px 14px 6px;font-size:15px}
    .sub{color:var(--muted);font-size:12px;padding:0 14px 8px}
    .section{padding:10px 14px 14px}
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .field{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,textarea{background:var(--card-2);border:1px solid rgba(255,255,255,.08);color:var(--text);border-radius:12px;padding:10px 12px;outline:none}
    input[type=text],input[type=url],input[type=password]{flex:1;min-width:180px}
    textarea{width:100%;min-height:140px;font-family:ui-monospace,Consolas,Menlo,monospace;font-size:12px}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,255,255,.1),rgba(255,255,255,.05));color:var(--text);cursor:pointer;font-weight:600;font-size:13px;box-shadow:var(--shadow)}
    .btn.ok{border-color:rgba(16,185,129,.35)}.btn.warn{border-color:rgba(245,158,11,.35)}.btn.err{border-color:rgba(239,68,68,.35)}
    .code{white-space:pre-wrap;background:#0b1020;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;font-size:12px;overflow:auto}
    .drop{border:2px dashed rgba(255,255,255,.25);border-radius:16px;padding:22px;text-align:center;color:var(--muted)}
    .drop.drag{border-color:var(--accent);color:var(--accent)}
    footer{text-align:center;color:var(--muted);font-size:12px;margin-top:16px}

    /* Mobile */
    @media(max-width:720px){
      .row>*{flex:1 1 100%}
      input,textarea{font-size:15px;padding:12px}
      .btn{font-size:15px;padding:12px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>OtOjs æ§åˆ¶å° + è§£ç å™¨ï¼ˆç¨³å®šç‰ˆï¼‰</h1>
        <div class="muted">GitHub å·¥å…· & æ–‡ä»¶/è¿œç¨‹/ç²˜è´´ & Prettier & é¢„è§ˆä¸‹è½½ Â· çº¯å‰ç«¯</div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>â‘  ä»“åº“è®¾ç½® & Raw/API</h2>
        <div class="sub">è®¾ç½®åç”¨äºç”Ÿæˆ Raw é“¾æ¥ã€ç¼–è¾‘é¡µã€API åœ°å€ã€‚</div>
        <div class="section">
          <div class="field">
            <label>REPO</label><input id="repo" type="text" value="Mikephie/OtOjs" />
            <label>BRANCH</label><input id="branch" type="text" value="main" />
            <button class="btn" id="btnSaveRepo">ä¿å­˜</button>
          </div>
        </div>
        <div class="section">
          <div class="field">
            <input id="relPath" type="text" value="input.js" placeholder="input.js æˆ– src/xxx.js" />
            <button class="btn" id="btnGenRaw">ç”Ÿæˆ Raw/API</button>
            <button class="btn" id="btnCopyRaw">å¤åˆ¶</button>
          </div>
          <div id="rawOut" class="code" style="margin-top:8px"></div>
        </div>
      </section>

      <section class="card">
        <h2>â‘¡ GitHub API å‘½ä»¤ä¸ç›´è¿</h2>
        <div class="sub">éœ€è¦ Tokenï¼ˆcontents: read & writeï¼‰ã€‚å¯ç”Ÿæˆ curl æˆ–ç›´æ¥è°ƒç”¨ APIã€‚</div>
        <div class="section">
          <div class="field"><input id="apiPath" type="text" value="input.js" /><input id="apiMsg" type="text" value="update: input.js via OtOjs UI" /></div>
          <div class="row">
            <button class="btn" id="btnCurlPut">ç”Ÿæˆ curl (PUT)</button>
            <button class="btn warn" id="btnCurlGet">ç”Ÿæˆ curl (GET)</button>
            <button class="btn" id="btnCurlCopy">å¤åˆ¶</button>
          </div>
          <div class="row">
            <input id="apiToken" type="password" placeholder="ghp_xxx Personal Access Token" />
            <button class="btn ok" id="btnApiPut">ç›´æ¥ä¸Šä¼  (PUT)</button>
            <button class="btn" id="btnApiGet">è¯»å– (GET)</button>
          </div>
          <div id="curlOut" class="code" style="margin-top:8px"></div>
        </div>
      </section>

      <section class="card">
        <h2>ğŸ§ª ç§‘æŠ€è§£ç å™¨</h2>
        <div class="sub">æ–‡ä»¶/è¿œç¨‹/ç²˜è´´ â†’ è§£å¯†/ç¾åŒ–/å¤åˆ¶/æ¸…ç©º</div>
        <div class="section">
          <div id="drop" class="drop">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–å…¥ï¼ˆ.js .txt .jsonï¼‰</div>
          <div class="row" style="margin-top:8px">
            <input type="file" id="file" accept=".js,.txt,.json" />
            <button class="btn" id="btnPick">é€‰æ‹©æ–‡ä»¶</button>
            <input id="remoteUrl" type="url" placeholder="https:// è¿œç¨‹è„šæœ¬åœ°å€" />
            <button class="btn" id="btnRemote">è¿œç¨‹åŠ è½½</button>
            <button class="btn" id="btnPaste">ç²˜è´´æ¿</button>
            <button class="btn err" id="btnClearInput">æ¸…ç©ºè¾“å…¥</button>
          </div>
        </div>
        <div class="section">
          <textarea id="codeIn" placeholder="è¯·ç²˜è´´éœ€è¦å¤„ç†çš„ JavaScript ä»£ç ..."></textarea>
        </div>
        <div class="section">
          <div class="row">
            <button class="btn ok" id="btnStart">å¼€å§‹è§£å¯†</button>
            <button class="btn" id="btnGet">è·å–ç»“æœ</button>
            <button class="btn" id="btnCopyOut">å¤åˆ¶</button>
            <button class="btn" id="btnBeautify">ä»£ç ç¾åŒ– (Prettier)</button>
            <button class="btn err" id="btnClearAll">æ¸…é™¤</button>
          </div>
          <pre id="codeOut" class="code" style="margin-top:8px;min-height:160px"></pre>
        </div>
      </section>

      <section class="card">
        <h2>â‘¢ output.js é¢„è§ˆ</h2>
        <div class="sub">ä» Raw æ‹‰å–å¿«é€ŸæŸ¥çœ‹ï¼Œå¹¶å¯ä¸‹è½½</div>
        <div class="section">
          <div class="row">
            <button class="btn" id="btnLoadOutput">æ‹‰å–æœ€æ–°è¾“å‡º</button>
            <button class="btn" id="btnCopyOutput">å¤åˆ¶</button>
            <button class="btn" id="btnDownloadOutput">ä¸‹è½½ output.js</button>
          </div>
          <pre id="outputView" class="code" style="margin-top:8px;max-height:360px"></pre>
        </div>
      </section>
    </div>

    <footer>OtOjs Â· å¯ç›´æ¥æ”¾ docs/ ä½œä¸º GitHub Pages</footer>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const st = { get repo(){return localStorage.getItem('repo')||'Mikephie/OtOjs'}, set repo(v){localStorage.setItem('repo',v)}, get branch(){return localStorage.getItem('branch')||'main'}, set branch(v){localStorage.setItem('branch',v)} };

    function toast(msg){ const el=document.createElement('div'); el.textContent=msg; el.style.cssText='position:fixed;left:50%;bottom:18px;transform:translateX(-50%);padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.65);border:1px solid rgba(255,255,255,.2);color:#fff;font-size:12px;z-index:9999'; document.body.appendChild(el); setTimeout(()=>el.remove(),1600); }

    function initLinks(){ const base=`https://github.com/${st.repo}`; const blob=`${base}/blob/${st.branch}`; const raw=`https://raw.githubusercontent.com/${st.repo}/${st.branch}`; $('#rawOut').dataset.base=base; $('#rawOut').dataset.blob=blob; $('#rawOut').dataset.raw=raw; }

    function genRaw(){ const rel=$('#relPath').value.trim().replace(/^\/+/,'')||'input.js'; const raw=`https://raw.githubusercontent.com/${st.repo}/${st.branch}/${rel}`; const api=`https://api.github.com/repos/${st.repo}/contents/${rel}?ref=${encodeURIComponent(st.branch)}`; $('#rawOut').textContent=`# å…¬å…±ç›´é“¾ (Raw)\n${raw}\n\n# ç§åº“ / éœ€ token çš„ API è¯»å–\n${api}`; }

    function headers(){ const t=$('#apiToken').value.trim(); return { 'Authorization': t?`Bearer ${t}`:undefined, 'Accept':'application/vnd.github+json' }; }

    async function genCurl(kind){ const path=$('#apiPath').value.trim().replace(/^\/+/,''); const msg=$('#apiMsg').value.trim(); const api=`https://api.github.com/repos/${st.repo}/contents/${path}`; if(kind==='GET'){ $('#curlOut').textContent=`curl -H "Authorization: Bearer YOUR_TOKEN" \n  -H "Accept: application/vnd.github+json" \n  \"${api}?ref=${st.branch}\"`; return; } try{ let sha=''; const r=await fetch(`${api}?ref=${st.branch}`); if(r.ok){ const j=await r.json(); sha=j.sha||''; } const src=$('#codeIn').value.trim()||$('#codeOut').textContent||'/* replace with your JS */'; const body={message:msg,content:btoa(unescape(encodeURIComponent(src))),branch:st.branch,sha:sha||undefined}; $('#curlOut').textContent=[`curl -X PUT \\`,`  -H "Authorization: Bearer YOUR_TOKEN" \\`,`  -H "Accept: application/vnd.github+json" \\`,`  ${JSON.stringify(api)} \\`,`  -d ${JSON.stringify(JSON.stringify(body))}`].join('\n'); }catch(e){ $('#curlOut').textContent='# ç”Ÿæˆå¤±è´¥ï¼š'+e.message; } }

    async function apiGet(){ const path=$('#apiPath').value.trim().replace(/^\/+/,''); const api=`https://api.github.com/repos/${st.repo}/contents/${path}?ref=${st.branch}`; try{ const res=await fetch(api,{headers:headers()}); if(!res.ok) throw new Error(res.status+' '+res.statusText); const j=await res.json(); const s=j.content?decodeURIComponent(escape(atob(j.content))):''; $('#codeOut').textContent=s; toast('å·²è¯»å– '+path); }catch(e){ toast('è¯»å–å¤±è´¥ï¼š'+e.message); } }

    async function apiPut(){ const path=$('#apiPath').value.trim().replace(/^\/+/,''); const msg=$('#apiMsg').value.trim()||'update via UI'; const api=`https://api.github.com/repos/${st.repo}/contents/${path}`; const src=$('#codeIn').value.trim()||$('#codeOut').textContent||''; if(!src){ toast('æ²¡æœ‰å¯ä¸Šä¼ çš„å†…å®¹'); return } try{ let sha=''; const chk=await fetch(`${api}?ref=${st.branch}`,{headers:headers()}); if(chk.ok){ const j=await chk.json(); sha=j.sha||''; } const body={message:msg,content:btoa(unescape(encodeURIComponent(src))),branch:st.branch,sha:sha||undefined}; const res=await fetch(api,{method:'PUT',headers:{'Content-Type':'application/json',...headers()},body:JSON.stringify(body)}); if(!res.ok) throw new Error(res.status+' '+res.statusText); toast('ä¸Šä¼ æˆåŠŸ'); }catch(e){ toast('ä¸Šä¼ å¤±è´¥ï¼š'+e.message); }
    }

    // è§£ç å™¨ I/O
    function pickFile(){ $('#file').click(); }
    function readFile(f){ return new Promise((resolve,reject)=>{ const r=new FileReader(); r.onload=()=>resolve(r.result); r.onerror=reject; r.readAsText(f,'utf-8'); }); }
    function attachDnd(){ const box=$('#drop'); box.addEventListener('dragover',e=>{e.preventDefault(); box.classList.add('drag')}); box.addEventListener('dragleave',()=>box.classList.remove('drag')); box.addEventListener('drop',async e=>{e.preventDefault(); box.classList.remove('drag'); const f=e.dataTransfer.files?.[0]; if(f){ $('#codeIn').value=await readFile(f); toast('å·²è½½å…¥ï¼š'+f.name); }}); }

    async function loadRemote(){ const u=$('#remoteUrl').value.trim(); if(!u){ toast('è¯·è¾“å…¥ URL'); return } try{ const r=await fetch(u); const t=await r.text(); $('#codeIn').value=t; toast('å·²åŠ è½½è¿œç¨‹è„šæœ¬'); }catch(e){ toast('åŠ è½½å¤±è´¥ï¼š'+e.message); } }
    async function pasteClipboard(){ try{ const t=await navigator.clipboard.readText(); $('#codeIn').value=t; toast('å·²ç²˜è´´'); }catch(e){ toast('è¯»å–å‰ªè´´æ¿å¤±è´¥ï¼š'+e.message); } }
    function clearInput(){ $('#codeIn').value=''; toast('å·²æ¸…ç©ºè¾“å…¥'); }

    function startDecode(){ const s=$('#codeIn').value||''; if(!s){ toast('æ— è¾“å…¥'); return } $('#codeOut').textContent=s; toast('å·²å¼€å§‹ï¼ˆç¤ºä¾‹ï¼šå›æ˜¾ï¼‰'); }
    function getResult(){ if(!$('#codeOut').textContent){ toast('æš‚æ— è¾“å‡º'); return } toast('å·²è·å–ç»“æœ'); }

    // Prettier
    function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=()=>rej(new Error('load failed: '+src)); document.head.appendChild(s); }); }
    async function ensurePrettier(){ if(window.prettier && window.prettierPlugins && window.prettierPlugins.babel) return; await loadScript('https://unpkg.com/prettier@3.2.5/standalone.js'); await loadScript('https://unpkg.com/prettier@3.2.5/plugins/babel.js'); }
    async function beautify(){ let s=$('#codeIn').value||$('#codeOut').textContent||''; if(!s){ toast('æ— å¾…ç¾åŒ–å†…å®¹'); return } try{ await ensurePrettier(); const out=prettier.format(s,{parser:'babel',plugins:[prettierPlugins.babel]}); $('#codeOut').textContent=out; toast('å·²ä½¿ç”¨ Prettier ç¾åŒ–'); }catch(e){ toast('Prettier å¤±è´¥ï¼š'+e.message); }
    }

    async function loadOutput(){ const url=`https://raw.githubusercontent.com/${st.repo}/${st.branch}/output.js`; try{ const r=await fetch(url); if(!r.ok) throw new Error(r.status+' '+r.statusText); $('#outputView').textContent=(await r.text()).slice(0,200000); toast('å·²æ‹‰å– output.js'); }catch(e){ $('#outputView').textContent='# æ‹‰å–å¤±è´¥ï¼š'+e.message+'\n'+url; }
    }
    function downloadOutput(){ const txt=$('#outputView').textContent||''; const blob=new Blob([txt],{type:'text/javascript;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='output.js'; a.click(); URL.revokeObjectURL(a.href); toast('å·²ä¸‹è½½ output.js'); }

    // ç»‘å®š
    function bind(){
      $('#repo').value=st.repo; $('#branch').value=st.branch; initLinks(); genRaw(); attachDnd();
      $('#btnSaveRepo').addEventListener('click',()=>{ st.repo=$('#repo').value.trim(); st.branch=$('#branch').value.trim(); initLinks(); genRaw(); toast('å·²ä¿å­˜'); });
      $('#btnGenRaw').addEventListener('click',genRaw);
      $('#btnCopyRaw').addEventListener('click',()=>copy('#rawOut','#btnCopyRaw'));
      $('#btnCurlPut').addEventListener('click',()=>genCurl('PUT'));
      $('#btnCurlGet').addEventListener('click',()=>genCurl('GET'));
      $('#btnCurlCopy').addEventListener('click',()=>copy('#curlOut','#btnCurlCopy'));
      $('#btnApiPut').addEventListener('click',apiPut);
      $('#btnApiGet').addEventListener('click',apiGet);
      $('#btnPick').addEventListener('click',pickFile);
      $('#file').addEventListener('change',async e=>{ const f=e.target.files?.[0]; if(f){ $('#codeIn').value=await readFile(f); toast('å·²è½½å…¥ï¼š'+f.name); }});
      $('#btnRemote').addEventListener('click',loadRemote);
      $('#btnPaste').addEventListener('click',pasteClipboard);
      $('#btnClearInput').addEventListener('click',clearInput);
      $('#btnStart').addEventListener('click',startDecode);
      $('#btnGet').addEventListener('click',getResult);
      $('#btnCopyOut').addEventListener('click',()=>copy('#codeOut','#btnCopyOut'));
      $('#btnBeautify').addEventListener('click',beautify);
      $('#btnClearAll').addEventListener('click',()=>{ $('#codeIn').value=''; $('#codeOut').textContent=''; toast('å·²æ¸…é™¤'); });
      $('#btnLoadOutput').addEventListener('click',loadOutput);
      $('#btnCopyOutput').addEventListener('click',()=>copy('#outputView','#btnCopyOutput'));
      $('#btnDownloadOutput').addEventListener('click',downloadOutput);
    }

    async function copy(sel, btnSel){ try{ const el=$(sel); const txt=el ? (el.value ?? el.textContent ?? '') : ''; await navigator.clipboard.writeText(txt); const b=$(btnSel); if(b){ const o=b.textContent; b.textContent='âœ… å·²å¤åˆ¶'; b.disabled=true; setTimeout(()=>{b.textContent=o; b.disabled=false},1200); } toast('å·²å¤åˆ¶'); }catch(e){ toast('å¤åˆ¶å¤±è´¥ï¼š'+e.message); } }

    window.addEventListener('error', e=> toast('è„šæœ¬é”™è¯¯: '+(e?.message||'')) );
    window.addEventListener('unhandledrejection', e=> toast('æœªå¤„ç†å¼‚å¸¸: '+(e?.reason?.message||e?.reason||'')) );

    document.addEventListener('DOMContentLoaded', bind);
  </script>
</body>
</html>