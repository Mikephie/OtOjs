<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OtOjs Â· è§£å¯†å‰ç«¯ï¼ˆåå°æ¢å¤ + æ™ºèƒ½è§£å¯†ï¼‰</title>
<style>
  :root{
    --bg:#0b0f14;--card:#0f1621;--muted:#9db1c7;--line:#1f2937;--line2:#223046;
    --text:#e6eef7;--btn:#152033;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;--link:#67e8f9;
    --accent:#3b82f6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
  a{color:var(--link)}
  .wrap{max-width:960px;margin:0 auto;padding:18px 14px 80px}
  h1{margin:10px 0 6px;font-size:20px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0}
  label{font-size:12px;color:var(--muted);margin-right:6px}
  input,select,textarea{width:100%;background:#0f1a2b;color:var(--text);border:1px solid var(--line2);border-radius:10px;padding:10px;font-size:13px}
  textarea{min-height:160px;font-family:ui-monospace,Consolas,Menlo,monospace}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
  .row>*{flex:1 1 200px}
  button{padding:10px 12px;border-radius:10px;border:1px solid #2b3b54;background:var(--btn);color:var(--text);cursor:pointer;font-weight:600}
  button.ok{border-color:var(--ok)}
  button.warn{border-color:var(--warn)}
  button.err{border-color:var(--err)}
  pre{white-space:pre-wrap;background:#0b1020;border:1px solid var(--line2);border-radius:10px;padding:10px;font-size:12px;max-height:380px;overflow:auto}
  small{color:var(--muted)}
  .bar-wrap{height:6px;background:#0b1020;border:1px solid var(--line2);border-radius:8px;overflow:hidden;margin-top:6px}
  .bar{height:100%;width:0%;background:var(--accent);transition:width 5s linear}
  .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--line2);border-radius:999px;padding:6px 10px;background:#0b1020}
  .hint{font-size:12px;color:var(--muted)}

  /* ä¸€æ’å°æŒ‰é’®ï¼ˆæ–‡ä»¶ / è¿œç¨‹ / ç²˜è´´ / æ ¼å¼ / æ¸…ç©ºï¼‰ */
  .btnbar{
    display:grid; grid-template-columns:repeat(5,1fr);
    gap:6px; margin-top:8px; position:relative; z-index:1;
  }
  .btncard{
    min-width:0; padding:10px 6px; border-radius:10px;
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); color:#fff;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    cursor:pointer; transition:transform .15s,background .15s,box-shadow .15s;
  }
  .btncard:hover{background:rgba(255,255,255,.12); transform:translateY(-1px); box-shadow:0 3px 8px rgba(0,0,0,.2)}
  .btnicon{font-size:16px}
  .btntxt{font-size:11px; font-weight:600; margin-top:2px}

  /* è¿œç¨‹å¼¹çª—ï¼ˆæ‚¬æµ®ï¼‰ */
  .remote-pop{
    position:fixed; left:0; top:0; width:min(92vw,360px);
    background:#0f1621; border:1px solid var(--line2); border-radius:12px;
    padding:10px; box-shadow:0 12px 28px rgba(0,0,0,.35);
    display:none; z-index:9999;
  }
  .remote-pop.show{display:block;}
  .remote-pop .pop-row{display:flex; gap:8px; margin-top:6px}
  .remote-pop input[type="url"]{
    flex:1 1 auto; min-width:0; background:#0f1a2b; border:1px solid var(--line2);
    border-radius:10px; padding:10px; color:var(--text); font-size:13px;
  }
  .remote-pop .pop-btn{ white-space:nowrap; padding:8px 12px; border-radius:10px; border:1px solid #2b3b54; background:var(--btn); color:var(--text) }
  .remote-pop .pop-btn.ok{ border-color:var(--ok) }
  .remote-pop .pop-btn.cancel{ border-color:var(--err) }

  /* æŠ˜å çš„é«˜çº§è®¾ç½® */
  details.setting{ margin-top:8px }
  details.setting summary{ cursor:pointer; color:var(--muted); user-select:none }
  details.setting summary::-webkit-details-marker{ display:none }
  details.setting summary::before{ content:"â–¸ "; }
  details.setting[open] summary::before{ content:"â–¾ "; }
</style>
</head>
<body>
<div class="wrap">
  <h1>OtOjs Â· è§£å¯†å‰ç«¯</h1>

  <div class="card">
    <!-- å…¨éƒ¨æ¬è¿›é«˜çº§è®¾ç½® -->
    <details class="setting">
      <summary>é«˜çº§è®¾ç½®</summary>
      <div class="row" style="margin-top:8px">
        <div><label>REPO</label><input id="repo" value="Mikephie/OtOjs" /></div>
        <div><label>BRANCH</label><input id="branch" value="main" /></div>
        <div><label>Tokenï¼ˆcontents:rwï¼‰</label><input id="token" type="password" placeholder="ghp_..." /></div>
      </div>
      <div class="row">
        <div><label>input.js è·¯å¾„</label><input id="pathIn" value="input.js" /></div>
        <div><label>æäº¤ä¿¡æ¯</label><input id="commitMsg" value="update: input.js via UI" /></div>
        <div>
          <label>è¦æ‹‰å–å“ªä¸ªè¾“å‡ºæ–‡ä»¶ï¼Ÿ</label>
          <select id="whichOut">
            <option value="output/output.js">ç¬¬â‘ æ¬¡äº§ç‰©ï¼šoutput/output.js</option>
            <option value="output/output.deob2.js">ç¬¬â‘¡æ¬¡äº§ç‰©ï¼šoutput/output.deob2.js</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div><label>è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰</label><input id="pollSec" type="number" value="5" /></div>
        <div><label>æœ€å¤§ç­‰å¾…ï¼ˆç§’ï¼‰</label><input id="maxWait" type="number" value="150" /></div>
        <div class="pill" title="å‰ç«¯å°†è‡ªåŠ¨å°è¯• Packer/Eval/AADecode è§£å¯†">
          <input id="autoSmart" type="checkbox" checked /> <span>è‡ªåŠ¨æ™ºèƒ½è§£å¯†</span>
        </div>
      </div>
      <div class="pill" style="margin-top:6px">
        <input id="autoResume" type="checkbox" checked />
        <span>æäº¤åå…è®¸åå°æ‰§è¡Œï¼Œå›åˆ°é¡µé¢è‡ªåŠ¨æ‹‰å–</span>
      </div>
    </details>
    <div class="hint">æäº¤åå¯åå°æ‰§è¡Œï¼›é¡µé¢å›åˆ°å‰å°ä¼šè‡ªåŠ¨æ¢å¤æ‹‰å–å¹¶å°è¯•æœ¬åœ°æ™ºèƒ½è§£å¯†ã€‚</div>
  </div>

  <div class="card">
    <small>æŠŠå¾…è§£å¯†è„šæœ¬æ”¾åˆ° <b>input.js</b> â†’ å·¥ä½œæµè‡ªåŠ¨è·‘ â†’ æœ¬åœ°è‡ªåŠ¨è¯†åˆ«æ˜¯å¦èƒ½å‰ç«¯è§£å¯†</small>

    <!-- éšè—æ–‡ä»¶ input -->
    <input type="file" id="file" accept=".js,.txt,.json" hidden />

    <!-- å°æŒ‰é’®åŒº -->
    <div class="btnbar">
      <label for="file" class="btncard"><span class="btnicon">ğŸ“</span><span class="btntxt">æ–‡ä»¶</span></label>
      <div class="btncard" id="btn-remote"><span class="btnicon">ğŸŒ</span><span class="btntxt">è¿œç¨‹</span></div>
      <button class="btncard" id="btn-paste" type="button"><span class="btnicon">ğŸ“‹</span><span class="btntxt">ç²˜è´´</span></button>
      <button class="btncard" id="btn-clean" type="button"><span class="btnicon">ğŸ§¹</span><span class="btntxt">æ ¼å¼</span></button>
      <button class="btncard" id="btn-clear" type="button"><span class="btnicon">ğŸ—‘ï¸</span><span class="btntxt">æ¸…ç©º</span></button>
    </div>

    <!-- è¿œç¨‹å¼¹çª— -->
    <div class="remote-pop" id="remote-pop">
      <input id="remoteUrlInline" type="url" placeholder="https:// åŸå§‹è„šæœ¬ URLï¼ˆæ”¯æŒ github/blob â†’ rawï¼‰" />
      <div class="pop-row">
        <button class="pop-btn ok" id="remote-confirm">æ‹‰å–</button>
        <button class="pop-btn cancel" id="remote-cancel">å–æ¶ˆ</button>
      </div>
    </div>
    <input id="remoteUrl" type="url" style="display:none" />

    <textarea id="codeIn" placeholder="æŠŠå¾…è§£å¯†çš„ JS ç²˜è´´åˆ°è¿™é‡Œï¼Œæˆ–ç”¨ä¸Šæ–¹å¯¼å…¥"></textarea>

    <div class="row">
      <button class="ok" onclick="submitInput()">â‘  æäº¤åˆ° input.js (PUT)</button>
      <button class="warn" onclick="startAutoPoll()">â‘¡ å¼€å§‹è‡ªåŠ¨è½®è¯¢ï¼ˆæ ¹æ®é€‰æ‹©çš„è¾“å‡ºæ–‡ä»¶ï¼‰</button>
      <button onclick="beautify()">ï¼ˆå¯é€‰ï¼‰ç»“æœç¾åŒ–</button>
      <button onclick="copySel('#codeOut', this)">å¤åˆ¶ç»“æœ</button>
      <button class="err" onclick="clrAll()">æ¸…ç©ºè¾“å…¥ä¸ç»“æœ</button>
    </div>

    <div id="status"><small>çŠ¶æ€ï¼šå°±ç»ª</small></div>
    <div class="bar-wrap" id="barWrap" style="display:none"><div class="bar" id="bar"></div></div>
    <pre id="codeOut" placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"></pre>
  </div>

  <div class="card">
    <div class="row">
      <div class="pill">
        <span>å¿«é€Ÿæ‹‰å– Rawï¼š</span>
        <button onclick="loadOutputRaw('output/output.js')">output/output.js</button>
        <button onclick="loadOutputRaw('output/output.deob2.js')">output/output.deob2.js</button>
      </div>
      <button onclick="copySel('#outputRaw', this)">å¤åˆ¶</button>
      <button onclick="downloadOutput()">ä¸‹è½½å½“å‰ç»“æœ</button>
    </div>
    <pre id="outputRaw"></pre>
  </div>
</div>

<script>
/* ====== åŸºç¡€å·¥å…· & çŠ¶æ€æ  ====== */
const $=s=>document.querySelector(s);
function setStatus(msg){ $('#status').innerHTML = '<small>çŠ¶æ€ï¼š'+ msg +'</small>'; }
function showBar(){ $('#barWrap').style.display='block'; const b=$('#bar'); b.style.transition='none'; b.style.width='0%'; void b.offsetWidth; b.style.transition='width 5s linear'; b.style.background='var(--accent)'; setTimeout(()=>b.style.width='100%',50); }
function okBar(){ $('#bar').style.background='var(--ok)'; }
function warnBar(){ $('#bar').style.background='var(--warn)'; }
function hideBar(){ $('#barWrap').style.display='none'; }
function ghHeaders(){ const t=$('#token').value.trim(); if(!t){ throw new Error('ç¼ºå°‘ Tokenï¼ˆéœ€è¦ contents: read & writeï¼‰'); } return {'Authorization':'Bearer '+t,'Accept':'application/vnd.github+json','If-None-Match':''}; }
function repoBase(){ return `https://api.github.com/repos/${$('#repo').value.trim()}` }
function nowTs(){ return Date.now().toString() }
</script>

<script>
/* ====== æ–‡ä»¶å¯¼å…¥ / è¿œç¨‹ / ç²˜è´´ / æ¸…ç©º / ç¾åŒ– ====== */
$('#file').addEventListener('change', async (e)=>{ const f=e.target.files?.[0]; if(!f) return; const txt=await f.text(); $('#codeIn').value=txt; setStatus('å·²è½½å…¥æœ¬åœ°æ–‡ä»¶ï¼š'+f.name+' Â· '+txt.length+' å­—ç¬¦'); trySmartDecodeAndShow(txt,'è¾“å…¥'); });

async function loadRemote(){
  let u=$('#remoteUrl').value.trim(); if(!u){ setStatus('è¯·è¾“å…¥ URL'); return }
  if(/https?:\/\/github\.com\/.+\/blob\//.test(u)){ u=u.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/'); }
  try{ const r=await fetch(u+'?t='+nowTs(),{cache:'no-store'}); const t=await r.text(); if(!r.ok) throw new Error(r.status+' '+r.statusText+' '+t.slice(0,200)); $('#codeIn').value=t; setStatus('è¿œç¨‹å·²åŠ è½½ Â· '+t.length+' å­—ç¬¦'); trySmartDecodeAndShow(t,'è¾“å…¥'); }catch(e){ setStatus('è¿œç¨‹åŠ è½½å¤±è´¥ï¼š'+e.message); }
}
async function pasteFromClipboard(){ try{ const t=await navigator.clipboard.readText(); $('#codeIn').value=t; setStatus('å·²ä»å‰ªè´´æ¿ç²˜è´´ Â· '+t.length+' å­—ç¬¦'); trySmartDecodeAndShow(t,'è¾“å…¥'); }catch(e){ setStatus('ç²˜è´´å¤±è´¥ï¼š'+e.message); } }
function clrIn(){ $('#codeIn').value=''; setStatus('å·²æ¸…ç©ºè¾“å…¥'); }
function clrAll(){ $('#codeIn').value=''; $('#codeOut').textContent=''; $('#outputRaw').textContent=''; hideBar(); setStatus('å·²æ¸…ç©ºè¾“å…¥ä¸ç»“æœ'); }
async function ensurePrettier(){ if(window.prettier&&window.prettierPlugins&&window.prettierPlugins.babel) return; const s1=document.createElement('script'); s1.src='https://unpkg.com/prettier@3.2.5/standalone.js'; const s2=document.createElement('script'); s2.src='https://unpkg.com/prettier@3.2.5/plugins/babel.js'; document.body.appendChild(s1); await new Promise(r=>s1.onload=r); document.body.appendChild(s2); await new Promise(r=>s2.onload=r); }
async function beautify(){ let s=$('#codeOut').textContent||$('#codeIn').value||''; if(!s){ setStatus('æ— å¾…ç¾åŒ–å†…å®¹'); return } try{ await ensurePrettier(); const out=prettier.format(s,{parser:'babel',plugins:[prettierPlugins.babel]}); $('#codeOut').textContent=out; setStatus('å·²ç”¨ Prettier ç¾åŒ–'); }catch(e){ setStatus('Prettier å¤±è´¥ï¼š'+e.message); } }
async function copySel(sel,btn){ try{ const el=$(sel); const t=el?(el.value??el.textContent??''):''; await navigator.clipboard.writeText(t); const old=btn.textContent; btn.textContent='âœ… å·²å¤åˆ¶'; setTimeout(()=>btn.textContent=old,1200);}catch(e){ setStatus('å¤åˆ¶å¤±è´¥ï¼š'+e.message); } }

/* è¿œç¨‹å¼¹çª—äº¤äº’ */
(function(){
  const btn = $('#btn-remote'), pop = $('#remote-pop'), inputInline = $('#remoteUrlInline'), inputHidden = $('#remoteUrl');
  function place(){ const r = btn.getBoundingClientRect(); const w = Math.min(360, Math.max(260, r.width*2)); pop.style.width=w+'px'; let left=r.left+r.width/2-w/2; left=Math.max(8, Math.min(left, innerWidth-w-8)); pop.style.left=left+'px'; pop.style.top=(r.bottom+8)+'px'; }
  function open(){ place(); pop.classList.add('show'); setTimeout(()=>inputInline?.focus(),0); }
  function close(){ pop.classList.remove('show'); }
  btn.addEventListener('click', e=>{ e.preventDefault(); pop.classList.contains('show')? close(): open(); });
  $('#remote-cancel').addEventListener('click', e=>{ e.preventDefault(); close(); });
  async function go(){ const u=(inputInline.value||'').trim(); if(!u){ setStatus('è¯·è¾“å…¥ URL'); inputInline.focus(); return;} inputHidden.value=u; close(); try{ await loadRemote(); }catch{} }
  $('#remote-confirm').addEventListener('click', e=>{ e.preventDefault(); go(); });
  inputInline.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); go(); }});
  document.addEventListener('click', e=>{ if(!btn.contains(e.target) && !pop.contains(e.target)) close(); });
  $('#btn-paste').addEventListener('click', e=>{ e.preventDefault(); pasteFromClipboard(); });
  $('#btn-clean').addEventListener('click', e=>{ e.preventDefault(); beautify(); });
  $('#btn-clear').addEventListener('click', e=>{ e.preventDefault(); clrIn(); });
})();
</script>

<script>
/* ====== GitHub æäº¤ & è½®è¯¢ï¼ˆæäº¤åå¯åå°æ¢å¤ï¼‰ ====== */
function b64ToUtf8(b64){ try{ return decodeURIComponent(escape(atob(b64))) }catch{ return atob(b64) } }

async function submitInput(){
  const path=$('#pathIn').value.trim()||'input.js';
  const api=`${repoBase()}/contents/${path}`;
  const code=$('#codeIn').value;
  if(!code){ setStatus('æ²¡æœ‰å¯ä¸Šä¼ çš„å†…å®¹'); return }
  try{
    let sha=''; const head=await fetch(`${api}?ref=${$('#branch').value.trim()}&t=${nowTs()}`,{headers:ghHeaders(),cache:'no-store'});
    if(head.ok){ const j=await head.json(); sha=j.sha||''; }
    const body={ message: $('#commitMsg').value.trim()||'update via UI', content: btoa(unescape(encodeURIComponent(code))), branch: $('#branch').value.trim(), sha: sha||undefined };
    const res=await fetch(api,{ method:'PUT', headers:{ 'Content-Type':'application/json', ...ghHeaders() }, cache:'no-store', body: JSON.stringify(body) });
    const txt=await res.text(); if(!res.ok) throw new Error(res.status+' '+res.statusText+' â†’ '+txt.slice(0,200));

    if ($('#autoResume').checked) {
      saveJobForAutoResume({
        repo: $('#repo').value.trim(),
        branch: $('#branch').value.trim(),
        whichOut: $('#whichOut').value,
        pollSec: Math.max(2, parseInt($('#pollSec').value||'5',10)),
        maxWait: Math.max(10, parseInt($('#maxWait').value||'150',10))
      });
      setStatus('æäº¤æˆåŠŸ Â· Actions åå°æ‰§è¡Œä¸­ï¼ˆå¯ç¦»å¼€é¡µé¢ï¼Œå›æ¥è‡ªåŠ¨æ‹‰å– + æ™ºèƒ½è§£å¯†ï¼‰');
    } else {
      setStatus('æäº¤æˆåŠŸ Â· å¦‚éœ€æ‹‰å–è¯·æ‰‹åŠ¨ç‚¹å‡»â€œå¼€å§‹è‡ªåŠ¨è½®è¯¢â€');
    }
  }catch(e){ setStatus('æäº¤å¤±è´¥ï¼š'+e.message); }
}

let pollingTimer=null, barTimer=null;
async function startAutoPoll(){
  try{ ghHeaders(); }catch(e){ setStatus(e.message); return }
  if(pollingTimer){ clearInterval(pollingTimer); pollingTimer=null; }
  if(barTimer){ clearInterval(barTimer); barTimer=null; }

  const which=$('#whichOut').value;
  const branch=$('#branch').value.trim();
  const api=`${repoBase()}/contents/${which}?ref=${branch}`;
  const interval=Math.max(2, parseInt($('#pollSec').value||'5',10))*1000;
  const maxWait=Math.max(10, parseInt($('#maxWait').value||'150',10))*1000;

  let lastSha=''; let waited=0;
  setStatus('æ­£åœ¨è½®è¯¢ï¼š'+which); showBar();
  barTimer=setInterval(()=>{ const b=$('#bar'); b.style.transition='none'; b.style.width='0%'; void b.offsetWidth; b.style.transition='width 5s linear'; b.style.width='100%'; },5000);

  await tryFetch();
  pollingTimer=setInterval(async ()=>{
    waited+=interval;
    const done=await tryFetch();
    if(done){ clearInterval(pollingTimer); pollingTimer=null; clearInterval(barTimer); barTimer=null; okBar(); return; }
    if(waited>=maxWait){ clearInterval(pollingTimer); pollingTimer=null; clearInterval(barTimer); barTimer=null; warnBar(); setStatus('âŒ› è¶…æ—¶ï¼šä»æœªè·å–åˆ° '+which); }
  }, interval);

  async function tryFetch(){
    try{
      const r=await fetch(api+'&t='+nowTs(),{headers:ghHeaders(),cache:'no-store'});
      const raw=await r.text();
      if(!r.ok){ setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆHTTP '+r.status+'ï¼‰'); return false; }
      const j=JSON.parse(raw); const sha=j.sha||''; if(sha && sha===lastSha){ setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆæœªæ›´æ–°ï¼‰'); return false; }
      const b64=(j.content||'').replace(/\n/g,''); const out=j.content?b64ToUtf8(b64):'';
      if(out && out.trim()){
        lastSha=sha||nowTs();
        const final = trySmartDecode(out);
        $('#codeOut').textContent = final;
        setStatus( final!==out ? 'âœ… å·²è·å–å¹¶æœ¬åœ°æ™ºèƒ½è§£å¯†' : 'âœ… å·²è·å–åˆ°æœ€æ–° '+which );
        return true;
      }else{ setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆæ–‡ä»¶ä¸ºç©ºæˆ–æœªç”Ÿæˆï¼‰'); return false; }
    }catch(e){ setStatus('ç­‰å¾…ä¸­â€¦ '+which+'ï¼ˆ'+e.message+'ï¼‰'); return false; }
  }
}

/* Raw / ä¸‹è½½ */
async function loadOutputRaw(path){
  path = path || $('#whichOut').value;
  const url=`https://raw.githubusercontent.com/${$('#repo').value.trim()}/${$('#branch').value.trim()}/${path}?t=${nowTs()}`;
  try{ const r=await fetch(url,{cache:'no-store'}); const t=await r.text(); if(!r.ok) throw new Error(r.status+' '+r.statusText);
    $('#outputRaw').textContent=t; setStatus('å·²æ‹‰å– Raw Â· '+path+' Â· '+t.length+' å­—ç¬¦'); }catch(e){ $('#outputRaw').textContent='æ‹‰å–å¤±è´¥ï¼š'+e.message+'\n'+url; setStatus('æ‹‰å–å¤±è´¥'); }
}
function downloadOutput(){ const t=$('#codeOut').textContent||$('#outputRaw').textContent||''; const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([t],{type:'text/javascript;charset=utf-8'})); const which=$('#whichOut').value.split('/').pop()||'output.js'; a.download=which; a.click(); URL.revokeObjectURL(a.href); }
</script>

<!-- ====== AADecode æ’ä»¶ï¼ˆå‰ç«¯ï¼‰ ====== -->
<script>
(function () {
  const module = { exports: {} };
  function extractHeader(code) {
    const i = code.search(/ï¾ŸÏ‰ï¾Ÿï¾‰\s*=|ï¾ŸĞ´ï¾Ÿ\s*=|ï¾ŸĞ”ï¾Ÿ\s*=|ï¾ŸÎ˜ï¾Ÿ\s*=/);
    if (i > 0) return { header: code.substring(0, i).trim(), encodedPart: code.substring(i) };
    return { header: "", encodedPart: code };
  }
  function plugin(code) {
    try {
      const { header, encodedPart } = extractHeader(code);
      if (!(encodedPart.includes("ï¾ŸĞ”ï¾Ÿ") || encodedPart.includes("(ï¾ŸÎ˜ï¾Ÿ)") || encodedPart.includes("ï¾ŸÏ‰ï¾Ÿï¾‰") || encodedPart.includes("ï¾ŸĞ´ï¾Ÿ"))) return null;
      let s = encodedPart.replace(") ('_')","").replace("(ï¾ŸĞ”ï¾Ÿ) ['_'] (","return ");
      const x = new Function(s); const out = x();
      return header ? `${header}\n\n${out}` : out;
    } catch (e) { console.error("AADecodeè§£ç é”™è¯¯:", e); return null; }
  }
  module.exports = plugin;
  window.DecodePlugins = window.DecodePlugins || {};
  window.DecodePlugins.aadecode = { detect:c=>/ï¾ŸÏ‰ï¾Ÿï¾‰|ï¾ŸĞ”ï¾Ÿ|ï¾ŸĞ´ï¾Ÿ|ï¾ŸÎ˜ï¾Ÿ/.test(c), plugin:c=>{ try{ const r=module.exports(c); return r??c; }catch(e){ console.error(e); return c; } } };
})();
</script>

<!-- ====== Eval è§£åŒ…ï¼ˆå‰ç«¯ï¼‰ ====== -->
<script>
(function () {
  const module = { exports: {} };
  function plugin(code) {
    try {
      if (!/eval\s*\(/.test(code)) return null;
      let m = code.replace(/eval\s*\(/g, "(function(x){return x;})(");
      try{
        const env = { window:{}, document:{}, navigator:{userAgent:"Mozilla/5.0"}, location:{} };
        const res = Function("window","document","navigator","location",`return ${m}`)(env.window,env.document,env.navigator,env.location);
        if (typeof res === "string") return /eval\s*\(/.test(res) ? plugin(res) : res;
        return String(res);
      }catch{
        try{ return code.replace(/eval\s*\(/g, "("); }catch{ return null; }
      }
    } catch (e) { console.error("Eval è§£åŒ…é”™è¯¯:", e); return null; }
  }
  module.exports.plugin = (c)=>plugin(c);
  window.DecodePlugins = window.DecodePlugins || {};
  window.DecodePlugins.eval = { detect:c=>/eval\s*\(/.test(c), plugin:c=>module.exports.plugin(c) };
})();
</script>

<!-- ====== P.A.C.K.E.R è§£åŒ…ï¼ˆå‰ç«¯ï¼‰ ====== -->
<script>
(function () {
  const P_RE = /^\s*eval\(function\s*\(\s*p\s*,\s*a\s*,\s*c\s*,\s*k\s*,\s*e\s*,\s*d\s*\)\s*\{/;
  function isPacked(code){ return P_RE.test(code); }
  function unpackOnce(source){
    if(!isPacked(source)) return null;
    const m = source.match(/eval\(function\(p,a,c,k,e,d\)\{[\s\S]*?\}\s*\(\s*(['"`])([\s\S]*?)\1\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(['"`])([\s\S]*?)\5\.split\('(\|)'\)\s*,/);
    if(!m) return null;
    const payload=m[2], radix=parseInt(m[3]), dictRaw=m[6], sep=m[7]||'|';
    const dict = dictRaw.split(sep);
    function unbase(str){ return parseInt(str, radix); }
    let p = payload.replace(/\\([\\'"`])/g,'$1')
                   .replace(/\\x([0-9A-Fa-f]{2})/g,(_,h)=>String.fromCharCode(parseInt(h,16)))
                   .replace(/\\u([0-9A-Fa-f]{4})/g,(_,h)=>String.fromCharCode(parseInt(h,16)));
    const tokenRe = /\b\w+\b/g;
    p = p.replace(tokenRe, w=>{ const idx=unbase(w); return Number.isNaN(idx)? w : (dict[idx]??w); });
    return p;
  }
  function unpackRecursive(code, max=6){
    let s=code; for(let i=0;i<max;i++){ const out=unpackOnce(s); if(out==null) break; s=String(out).trim(); }
    return s;
  }
  window.DecodePlugins = window.DecodePlugins || {};
  window.DecodePlugins.packer = { detect: c=>P_RE.test(c), plugin: c=>{ try{ const out=unpackRecursive(c); return out||c; }catch(e){ console.error('Packer è§£åŒ…å¤±è´¥',e); return c; } } };
})();
</script>

<!-- ====== æ™ºèƒ½è§£å¯†ï¼ˆè‡ªåŠ¨ï¼‰ ====== -->
<script>
function trySmartDecode(text){
  if(!$('#autoSmart').checked) return text;
  let before = String(text), changed = false, rounds = 0;
  const maxRounds = 6;
  while(rounds++ < maxRounds){
    let cur = before;
    // é¡ºåºï¼šPacker -> Eval -> AA
    try{ if(window.DecodePlugins?.packer?.detect(cur)){ const t = window.DecodePlugins.packer.plugin(cur); if(typeof t==='string') cur = t; } }catch{}
    try{ if(window.DecodePlugins?.eval?.detect(cur)){ const t = window.DecodePlugins.eval.plugin(cur); if(typeof t==='string') cur = t; } }catch{}
    try{ if(window.DecodePlugins?.aadecode?.detect(cur)){ const t = window.DecodePlugins.aadecode.plugin(cur); if(typeof t==='string') cur = t; } }catch{}
    if(cur === before) break;
    before = cur; changed = true;
  }
  return changed ? before : text;
}
function trySmartDecodeAndShow(src,label){
  if(!$('#autoSmart').checked) return;
  const out = trySmartDecode(src);
  if(out !== src){
    $('#codeOut').textContent = out;
    setStatus(`âœ… ${label} Â· æœ¬åœ°æ™ºèƒ½è§£å¯†å®Œæˆ`);
  }
}

/* ====== åå°æ¢å¤è½®è¯¢ï¼ˆå«æ™ºèƒ½è§£å¯†ï¼‰ ====== */
function saveJobForAutoResume(job){
  const data = { ...job, startedAt: Date.now(), lastSha:'', etag:'', expiry: Date.now()+job.maxWait*1000+5*60*1000 };
  localStorage.setItem('oto_auto_job', JSON.stringify(data));
}
function loadJob(){ try{ const raw=localStorage.getItem('oto_auto_job'); if(!raw) return null; const j=JSON.parse(raw); if(!j || !j.expiry || Date.now()>j.expiry){ localStorage.removeItem('oto_auto_job'); return null; } return j; }catch{ return null; } }
function clearJob(){ localStorage.removeItem('oto_auto_job'); }
async function pollOutputOnce(job, state){
  const api=`https://api.github.com/repos/${job.repo}/contents/${job.whichOut}?ref=${job.branch}&t=${Date.now()}`;
  const headers={ ...ghHeaders() }; if(state.etag){ headers['If-None-Match']=state.etag; }
  const res=await fetch(api,{headers,cache:'no-store'});
  if(res.status===304){ setStatus('ç­‰å¾…ä¸­â€¦ï¼ˆæœªæ”¹å˜ 304ï¼‰'); return {done:false}; }
  const text=await res.text(); if(!res.ok){ setStatus(`ç­‰å¾…ä¸­â€¦ï¼ˆHTTP ${res.status}ï¼‰`); return {done:false}; }
  const etag=res.headers.get('ETag')||state.etag; const j=JSON.parse(text); const sha=j.sha||''; const b64=(j.content||'').replace(/\n/g,''); const raw=j.content?b64ToUtf8(b64):'';
  if(state.sha && sha===state.sha){ setStatus('ç­‰å¾…ä¸­â€¦ï¼ˆæœªæ›´æ–°ï¼‰'); return {done:false, etag, sha: state.sha}; }
  if(raw && raw.trim()){
    const final = trySmartDecode(raw);
    $('#codeOut').textContent = final;
    setStatus( final!==raw ? `âœ… æœ¬åœ°æ™ºèƒ½è§£å¯†å®Œæˆ Â· ${final.length} å­—ç¬¦` : `âœ… å·²è·å–åˆ°æœ€æ–° ${job.whichOut} Â· ${raw.length} å­—ç¬¦`);
    return {done:true, etag, sha};
  }
  setStatus('ç­‰å¾…ä¸­â€¦ï¼ˆæ–‡ä»¶ä¸ºç©ºæˆ–æœªç”Ÿæˆï¼‰'); return {done:false, etag, sha};
}
async function autoResumeIfNeeded(){
  const job=loadJob(); if(!job) return;
  const short=Math.max(2, parseInt(job.pollSec||5,10)), long=Math.min(30, short*3);
  let waited=0, sha='', etag='';
  setStatus(`â³ æ­£åœ¨æ¢å¤è½®è¯¢ï¼š${job.whichOut}`); showBar();
  const b=$('#bar'); const barTimer=setInterval(()=>{ b.style.transition='none'; b.style.width='0%'; void b.offsetWidth; b.style.transition='width 5s linear'; b.style.width='100%'; },5000);
  async function tick(){
    const interval=document.hidden? long*1000 : short*1000;
    const {done, sha:newSha, etag:newEtag}=await pollOutputOnce(job,{sha,etag});
    if(newSha) sha=newSha; if(newEtag) etag=newEtag;
    if(done){ okBar(); clearInterval(timer); clearInterval(barTimer); clearJob(); return; }
    waited+=interval;
    if(waited>=job.maxWait*1000){ warnBar(); clearInterval(timer); clearInterval(barTimer); setStatus(`âŒ› è¶…æ—¶ï¼šä»æœªè·å–åˆ° ${job.whichOut}`); }
  }
  await tick();
  const timer=setInterval(tick, short*1000);
  document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) tick(); }, {passive:true});
}
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) autoResumeIfNeeded(); }, {passive:true});
window.addEventListener('load', autoResumeIfNeeded);
</script>
</body>
</html>
